import os, asyncio
from telethon import TelegramClient, events

# ุชูุธูุงุช ุงููุช (ููุงุฏุฑ ุงุฒ GitHub Secrets ุฎูุงูุฏู ูโุดููุฏ)
API_ID = int(os.getenv('API_ID', 0))
API_HASH = os.getenv('API_HASH', '')
BOT_TOKEN = os.getenv('BOT_TOKEN', '')

# ุฑุงูโุงูุฏุงุฒ ุฑุจุงุช
client = TelegramClient('favme_bot', API_ID, API_HASH).start(bot_token=BOT_TOKEN)

print("๐ FavMe Bot is Running Securely...")

@client.on(events.ChatAction)
async def group_handler(event):
    try:
        user = await event.get_user()
        # ูุงุฏุฏู ฺฏุฑูุชู ุฑุจุงุชโูุง
        if not user or user.bot:
            return

        # --- ูุชู ุฎูุดโุขูุฏฺฏู ุงุฎุชุตุงุต ููุฑุฏุงุฏ ---
        welcome_text = f"""ุณูุงู {user.first_name} ุนุฒุฒ

ู ุชูุถุญ ฺฉูุชุงู ุงูู ฺฉุงุฑ: ุงู ูพุงู ุจูโุตูุฑุช ุงุชููุงุชฺฉ ุชูุณุท ุจุงุช ุชูฺฏุฑุงู ู ฺฉุฏูุง ูพุงุชูู ุงุฑุณุงู ุดุฏูุ ูพุณ ุงฺฏู ุฌูุงุจ ูุฏุงุฏู ุจุฏูู ุง ุขููุงูู ุง ุฎูุงุจู ุง ุจู ุชูฺฏุฑุงู ุฏุณุชุฑุณ ูุฏุงุฑู.
ุฎุจโฆ

ุจู ฺฏุฑูู ุดุฎุต ููุ ููุฑุฏุงุฏุ ุฎูุด ุงููุฏ.

ุงู ฺฉู ุงูุงู ุงูุฌุง ุนู ุงุญุชูุงูุงู ูโุณุฑ ุณููู ู ุนูุงููโ ูุดุชุฑฺฉ ุฏุงุฑูุ

ุงุฒ ููู ู ููุณู ฺฏุฑูุชู ุชุง ุญุงูโูููุง ุฑูุฒูุฑู ู ฺุฒุง ฺฉู ุชู ุงู ุฏูุง ูุฌุงุฒ ุจุง ูู ุดุฑฺฉ ูโุดู.
ุงูุฏูุงุฑู ุชู ฺฏุฑูู ูุญุธุงุช ุฎูุจ ุฏุงุดุชู ุจุงุด ู ูุทุงูุจ ุจู ฺฉุงุฑุช ุจุงุฏ.

ููููู ฺฉู ูุณุช.
ุงฺฏู ุฎูุฏุช ูู ฺฉุงูุงู ุฏุงุฑุ ููฺฉุดู ูููโุฌุง ุจูุฑุณุชุ

ุจู ูุญุถ ุงู ฺฉู ุฎูุฏู (ูู ุฑุจุงุช) ุขููุงู ุจุดูุ ุญุชูุงู ุณุฑ ูโุฒูู.

ุงฺฏู ุฏูุณุช ุฏุงุดุชุ ุฎูุฏุช ุฑู ูู ูุนุฑู ฺฉู.
โจ ุจู ฺฏุฑูู 'A Beautiful Mind' ุฎูุด ุงููุฏ"""

        # --- ูุชู ุฎุฏุงุญุงูุธ ุงุฎุชุตุงุต ููุฑุฏุงุฏ ---
        goodbye_text = f"""ุฏุฏู ุฑูุชุ ฺฏูุชู ุจฺฏู: ฺุฑุงุ ๐
ุดูุฎ ุดูุฎโฆ
ุจูโูุฑุญุงู ููููู ุงุฒ ููุฑุงูโุชุ ุณูุงูุช ุจุงุด."""

        # ฑ. ูุฏุฑุช ูุฑูุฏ (Join)
        if event.user_joined or event.user_added:
            # ุงุฑุณุงู ูพุงู ุจู ุตูุฑุช ุฑูพูุง ุฑู ฺฉุงุฑุจุฑ
            sent_msg = await event.reply(welcome_text)
            print(f"โ ุฎูุดโุขูุฏฺฏู ุงุฑุณุงู ุดุฏ. ุญุฐู ุฎูุฏฺฉุงุฑ ุชุง ต ุฏููู ุฏฺฏุฑ...")
            
            # ุงูุชุธุงุฑ ุจุฑุง ต ุฏููู (ณฐฐ ุซุงูู)
            await asyncio.sleep(300)
            await sent_msg.delete()
            print("๐๏ธ ูพุงู ุฎูุดโุขูุฏฺฏู ูพุงฺฉ ุดุฏ.")

        # ฒ. ูุฏุฑุช ุฎุฑูุฌ (Leave)
        elif event.user_left:
            sent_msg = await client.send_message(event.chat_id, goodbye_text)
            print(f"๐ ุฎุฏุงุญุงูุธ ุงุฑุณุงู ุดุฏ. ุญุฐู ุฎูุฏฺฉุงุฑ ุชุง ต ุฏููู ุฏฺฏุฑ...")
            
            await asyncio.sleep(3000)
            await sent_msg.delete()
            print("๐๏ธ ูพุงู ุฎุฏุงุญุงูุธ ูพุงฺฉ ุดุฏ.")

    except Exception as e:
        print(f"โ ุฎุทุง ุฏุฑ ุนููุงุช: {e}")

# ุฒูุฏู ูฺฏู ุฏุงุดุชู ุฑุจุงุช
client.run_until_disconnected()
